!function(){var a={server_status:"dead",add_lm_torrent:function(a){var b=$.Deferred();return $.ajax({url:"ajax.php",type:"POST",data:{action:"addTorrent",url:a},success:function(a){b.resolve(a)},error:function(a){b.reject(a)},dataType:"html"}),b.promise()},start_utorrent_server:function(){var a=$.Deferred();return $.ajax({url:"ajax.php",type:"POST",data:{action:"start_utserver"},success:function(b){a.resolve(b)},error:function(b){a.fail(b)},dataType:"json"}),a.promise()},stop_utorrent_server:function(){var a=$.Deferred();return $.ajax({url:"ajax.php",type:"POST",data:{action:"stop_utserver"},success:function(b){a.resolve(b)},error:function(b){a.fail(b)},dataType:"json"}),a.promise()},check_utorrent_status:function(){var a=$.Deferred();return $.ajax({url:"ajax.php",type:"POST",data:{action:"get_server_status"},success:function(b){a.resolve(b)},error:function(b){a.reject(b)},dataType:"json"}),a.promise()},torrent_status_timer:null,torrent_delta_ts:null,get_torrent_status:function(){var a=this;$.ajax({url:"ajax.php",type:"POST",data:{action:"get_torrent_status",delta_ts:a.torrent_delta_ts},success:function(c){"undefined"!=typeof c.delta_ts&&(a.torrent_delta_ts=c.delta_ts),b.display_statuses(c)},error:function(a){},dataType:"json"})},get_torrent_status_subscribe:function(){if(null==this.torrent_status_timer){var a=this;this.torrent_status_timer=setInterval(function(){"alive"==a.server_status&&a.get_torrent_status()},5e3)}},get_torrent_status_unsubscribe:function(){clearInterval(this.torrent_status_timer),this.torrent_status_timer=null},get_free_space:function(){$.ajax({type:"POST",url:"ajax.php",data:{action:"get_free_space"},dataType:"json"}).then(function(a){$("#free_space").text(a.free_space+" GB"),a.free_space<40?$("#free_space").removeClass("label-info").addClass("label-warning"):a.free_space<15&&$("#free_space").removeClass("label-info").addClass("label-danger")})}},b={indicate_server_alive:function(){$("#status").removeClass("label-danger").addClass("label-success").text("Gyvas")},indicate_server_dead:function(){$("#status").removeClass("label-success").addClass("label-danger").text("Mir\u0119s")},start_url_add:function(){$("#add_btn_div").hide(),$("#add_progress").show()},stop_url_add:function(){$("#add_progress").hide(),$("#add_btn_div").show(),$("#url").val("")},hide_url_alerts:function(){$(".alert-success").hide(),$(".alert-danger").hide()},indicate_url_added:function(){$(".alert.alert-success").show()},indicate_url_not_added:function(){$(".alert.alert-danger").show()},enable_server_start:function(){$("#start_server").removeAttr("disabled").removeClass("btn-default").addClass("btn-primary")},enable_server_stop:function(){$("#stop_server").removeAttr("disabled").removeClass("btn-default").addClass("btn-warning")},enable_torrent_addition:function(){$("#add_torrent").removeAttr("disabled").removeClass("btn-default").addClass("btn-success")},disable_server_start:function(){$("#start_server").attr("disabled","disabled").removeClass("btn-primary").addClass("btn-default")},disable_server_stop:function(){$("#stop_server").attr("disabled","disabled").removeClass("btn-warning").addClass("btn-default")},disable_torrent_addition:function(){$("#add_torrent").attr("disabled","disabled").removeClass("btn-success").addClass("btn-default")},show_global_warning_message:function(a){$(".container").prepend('<div class="alert alert-warning alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+a+"</div>")},server_control_start:function(){$("#start_server").hide(),$("#stop_server").hide(),$("#server_control_progress").show()},server_control_stop:function(){$("#start_server").show(),$("#stop_server").show(),$("#server_control_progress").hide()},display_statuses:function(a){if(null!=a.list){$("#statuses").empty();var b=$("#show_only_active").prop("checked");a.list.map(function(a){if(b&&"Finished"!=a.status||!b){var c=['<div class="progress pull-left" style="width: 75%;">','<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="'+a.progress+'" aria-valuemin="0" aria-valuemax="100" style="width: '+a.progress+'%">',a.progress+"%","</div>","</div>"].join("");$("#statuses").append('<div class="row"></div>'),$("#statuses .row:last").append('<div class="col-md-4">'+a.name.substring(0,35)+"</div>").append('<div class="col-md-8">'+c+'<span style="margin-top: 0.5%; width: 24%;" class="label label-success pull-right">'+a.download_speed+" MB/s</span></div>")}})}},enable_torrent_status_autorefresh:function(){$("#autorefresh").prop("checked",!0)},disable_torrent_status_autorefresh:function(){$("#autorefresh").prop("checked",!1)},enable_torrent_only_active:function(){$("#show_only_active").prop("checked",!0)},disable_torrent_only_active:function(){$("#show_only_active").prop("checked",!1)},show_torrent_status_loader:function(){$("#statuses").empty().append(['<div class="progress" style="margin-left: 20px; margin-right: 20px;" id="server_control_progress">','<div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;">',"</div>","</div>"].join(""))}};$(document).ready(function(){$("#url").val("").focus(),b.server_control_start(),a.get_free_space(),a.check_utorrent_status().done(function(c){b.server_control_stop(),"alive"==c.status?(b.indicate_server_alive(),b.enable_server_stop(),b.disable_server_start(),b.enable_torrent_addition(),b.show_torrent_status_loader(),a.server_status="alive",a.get_torrent_status(),a.get_torrent_status_subscribe()):(b.indicate_server_dead(),b.enable_server_start(),b.disable_server_stop(),a.server_status="dead",a.get_torrent_status_unsubscribe(),b.disable_torrent_status_autorefresh())}).fail(function(a){b.server_control_stop(),b.indicate_server_dead(),b.show_global_warning_message("Ka\u017ekas atsitiko: "+a)}),$("#add_torrent").click(function(){$("#url").val().length<10?b.show_global_warning_message("Blogas linkas, pataisyk!"):(b.start_url_add(),a.add_lm_torrent($("#url").val()).done(function(a){b.stop_url_add();try{var c=JSON.parse(a)}catch(d){var c=null}"object"==typeof c&&"undefined"!=typeof c.build?(b.indicate_url_added(),setTimeout(function(){b.hide_url_alerts()},3e3)):(b.indicate_url_not_added(),b.show_global_warning_message(a),setTimeout(function(){b.hide_url_alerts()},3e3))}).fail(function(){b.stop_url_add(),b.indicate_url_not_added(),setTimeout(function(){b.hide_url_alerts()},3e3)}))}),$("#start_server").click(function(){b.server_control_start(),a.start_utorrent_server().done(function(c){b.server_control_stop(),"started"==c.status?(b.indicate_server_alive(),b.enable_server_stop(),b.disable_server_start(),b.enable_torrent_addition(),b.show_torrent_status_loader(),a.server_status="alive",a.get_torrent_status(),a.get_torrent_status_subscribe(),b.enable_torrent_status_autorefresh()):(b.indicate_server_dead(),b.enable_server_start(),b.disable_server_stop(),a.server_status="dead",a.get_torrent_status_unsubscribe(),b.disable_torrent_status_autorefresh())}).fail(function(a){b.server_control_stop(),b.show_global_warning_message("Serveris nestartuoja: "+a)})}),$("#stop_server").click(function(){b.server_control_start(),a.stop_utorrent_server().done(function(c){b.server_control_stop(),"stopped"==c.status&&(b.indicate_server_dead(),b.enable_server_start(),b.disable_server_stop(),b.disable_torrent_addition(),a.server_status="dead",a.get_torrent_status_unsubscribe(),b.disable_torrent_status_autorefresh())}).fail(function(a){b.server_control_stop(),b.show_global_warning_message("Ka\u017ekas atsitiko: "+a)})}),$("#autorefresh").change(function(){this.checked?(a.get_torrent_status(),a.get_torrent_status_subscribe()):a.get_torrent_status_unsubscribe()}),$("#refresh_now").click(function(){a.get_torrent_status()}),$("#show_only_active").change(function(){a.get_torrent_status()})})}();